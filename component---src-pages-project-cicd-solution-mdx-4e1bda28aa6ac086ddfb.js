(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"013z":function(e,a,t){"use strict";t("KKXr"),t("pIFo");var n=t("pOBw"),i=t("q1tI"),r=t.n(i),c=t("NmYn"),l=t.n(c),p=t("OKom"),o=t("k4MR"),b=t("TSYQ"),s=t.n(b),m=t("QH2O"),u=t("qKvR"),g=function(e){var a,t=e.title,n=e.tabs,i=void 0===n?[]:n;return Object(u.b)("div",{className:s()(m.pageHeader,(a={},a[m.withTabs]=i.length,a))},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12"},Object(u.b)("h1",{id:"page-title",className:m.text},t)))))},d=t("pEPl"),N=t("BAC9"),O=function(e){var a=e.relativePagePath,t=e.repository,n=d.data.site.siteMetadata.repository,i=t||n,r=i.baseUrl,c=i.subDirectory,l=r+"/edit/"+i.branch+c+"/src/pages"+a;return r?Object(u.b)("div",{className:"bx--row "+N.row},Object(u.b)("div",{className:"bx--col"},Object(u.b)("a",{className:N.link,href:l},"Edit this page on GitHub"))):null},j=t("FCXl"),h=(t("Oyvg"),t("Wbzz")),A=t("I8xM");var E=function(e){var a,t;function n(){return e.apply(this,arguments)||this}return t=e,(a=n).prototype=Object.create(t.prototype),a.prototype.constructor=a,a.__proto__=t,n.prototype.render=function(){var e=this.props,a=e.tabs,t=e.slug,n=t.split("/").filter(Boolean).slice(-1)[0],i=a.map((function(e){var a,i=l()(e,{lower:!0}),r=i===n,c=new RegExp(n+"(?!-)"),p=t.replace(c,i);return Object(u.b)("li",{key:e,className:s()((a={},a[A.selectedItem]=r,a),A.listItem)},Object(u.b)(h.Link,{className:A.link,to:""+p},e))}));return Object(u.b)("div",{className:A.tabsContainer},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(u.b)("nav",null,Object(u.b)("ul",{className:A.list},i))))))},n}(r.a.Component),f=t("MjG9");a.a=function(e){var a=e.pageContext,t=e.children,i=e.location,r=e.Title,c=a.frontmatter,b=void 0===c?{}:c,s=a.relativePagePath,m=a.titleType,d=b.tabs,N=b.title,h=b.theme,A=b.description,y=b.keywords,v=n.data.site.pathPrefix,T=v?i.pathname.replace(v,""):i.pathname,k=d?T.split("/").slice(-1)[0]||l()(d[0],{lower:!0}):"";return Object(u.b)(o.a,{tabs:d,homepage:!1,theme:h,pageTitle:N,pageDescription:A,pageKeywords:y,titleType:m},Object(u.b)(g,{title:r?Object(u.b)(r,null):N,label:"label",tabs:d}),d&&Object(u.b)(E,{slug:T,tabs:d,currentTab:k}),Object(u.b)(f.a,{padded:!0},t,Object(u.b)(O,{relativePagePath:s})),Object(u.b)(j.a,{pageContext:a,location:i,slug:T,tabs:d,currentTab:k}),Object(u.b)(p.a,null))}},aRVz:function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return c})),t.d(a,"default",(function(){return m}));t("91GP"),t("rGqo"),t("yt8O"),t("Btvt"),t("RW0V"),t("q1tI");var n=t("7ljp"),i=t("013z");t("qKvR");function r(){return(r=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var c={},l=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",a)}},p=l("AnchorLinks"),o=l("AnchorLink"),b={_frontmatter:c},s=i.a;function m(e){var a=e.components,t=function(e,a){if(null==e)return{};var t,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,["components"]);return Object(n.b)(s,r({},b,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)(p,{mdxType:"AnchorLinks"},Object(n.b)(o,{mdxType:"AnchorLink"},"OpenShift Setup"),Object(n.b)(o,{mdxType:"AnchorLink"},"Configure Github Personal Access Token"),Object(n.b)(o,{mdxType:"AnchorLink"},"ArgoCD Configuration"),Object(n.b)(o,{mdxType:"AnchorLink"},"Tekton Pipeline Configuration"),Object(n.b)(o,{mdxType:"AnchorLink"},"Tekton Trigger Configuration")),Object(n.b)("h2",null,"OpenShift Setup"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Create a new project ",Object(n.b)("inlineCode",{parentName:"li"},"bootcamp-cicd-${userid}")," all lowercase, and no spaces",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc new-project bootcamp-cicd-${userid}\n"))),Object(n.b)("li",{parentName:"ul"},"Set the environment variable ",Object(n.b)("inlineCode",{parentName:"li"},"NAMESPACE")," to be use during Solution",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'export NAMESPACE=$(oc project -q)\necho "NAMESPACE set to $NAMESPACE"\n')))),Object(n.b)("h2",null,"Configure Github Personal Access Token"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"For your CI pipeline to connect to and use your GitHub repo, it will need a ",Object(n.b)("a",r({parentName:"li"},{href:"https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line"}),"GitHub personal access token")," with ",Object(n.b)("inlineCode",{parentName:"li"},"public_repo")," and ",Object(n.b)("inlineCode",{parentName:"li"},"write:repo_hook")," scopes. "),Object(n.b)("li",{parentName:"ul"},"Navigate to ",Object(n.b)("a",r({parentName:"li"},{href:"https://github.com/settings/tokens"}),"Developer Settings")," and generate a new token; name it something like “CI pipeline”"),Object(n.b)("li",{parentName:"ul"},"Select ",Object(n.b)("inlineCode",{parentName:"li"},"public_repo")," scope to enable git clone"),Object(n.b)("li",{parentName:"ul"},"Select ",Object(n.b)("inlineCode",{parentName:"li"},"write:repo_hook")," scope so the pipeline can create a web hook\n",Object(n.b)("span",r({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(n.b)("span",r({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"80.25851938895417%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACQ0lEQVQ4y3VTaXPaMBDl//+wfmuZkIZAIQkY2/iQZMm38PG6qxiaiV3NrCVL2qf39liN44iiKNC2LXjw/zgMGPoOdV2jbi1qa1HReV7VaGjt7vzHVgxSlBVSIZEZg67vHfBAJpSGvF6RXjyoMESjJGxuML2MpbEabxaNSBG+HXF+3SIhZxt6aH6vId4OSPdbiM0vZM9r1Ict+sjHeFeyxHCsS1SBh+iwR/Rnh1Yk6N73sP4ZSkpIbSDzEmmmUZL8r2NcYLnizYZiJZIUSRyjs/YhWZscGQFpMkPAPN/o3Nob+ik0c4b0kSrDxQ9wOnsoKfA8uq5z+4pMcHy1duAc6zQVMHnuQBcBNV0OgtCBcmZ58GVFABkxY1BNc/bFeK9pPitjmAFSdlMhkKSpe/kOWBQl8rxwc1lVyIviscf/3+P4AGQpnneBMeZxyIB3ySoj2VK5Ne9JXpNPQtJ53bYcV/uvDvknThIH/BWQ43UHlUo5ZwbmfTGdFWXpWPP8YFgRfQbkS9wx4wTIceNwGMo2rxmApdZ1g5KagbP9vYw+Y0jMLr6P0+mMiErHMaQsC6pDNUnMSDY/PAzDDGTWetxuHA8/vCKh5IxTHSYsjywm5ppkPUDuttgpxCQjuUkQODPEaiwMbnGIPI7QnI5oj9RB2ye0L2tYWjvbbTC0zQx4xc7644jLyzNOT2sEuy3anz9Qv25w/XhHEkVkMSR1Um9bDNT7zqaszluP5HZlgYwc5TWEJlZ8kSUbCjy3X+7qsJ45L0n+Cw6O04qAEUMyAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",r({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Pipeline OAuth scopes",title:"Pipeline OAuth scopes",src:"/learning-cloudnative-101/static/cddc3c4fec890fc48da7a08658fd85cc/3cbba/github-access-token.png",srcSet:["/learning-cloudnative-101/static/cddc3c4fec890fc48da7a08658fd85cc/7fc1e/github-access-token.png 288w","/learning-cloudnative-101/static/cddc3c4fec890fc48da7a08658fd85cc/a5df1/github-access-token.png 576w","/learning-cloudnative-101/static/cddc3c4fec890fc48da7a08658fd85cc/3cbba/github-access-token.png 1152w","/learning-cloudnative-101/static/cddc3c4fec890fc48da7a08658fd85cc/1ed16/github-access-token.png 1702w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(n.b)("li",{parentName:"ul"},"The GitHub UI will never again let you see this token, so be sure to ",Object(n.b)("strong",{parentName:"li"},"save the token")," in your password manager or somewhere safe that you can access later on"),Object(n.b)("li",{parentName:"ul"},"Create the secret for the Infra repository, replace ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_USERNAME>")," and ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_TOKEN>"),", keep the quotes",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export GIT_USERNAME='<GIT_USERNAME>'\nexport GIT_TOKEN='<GIT_TOKEN>'\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'oc create secret generic git-infra-secret --from-literal=username="$GIT_USERNAME" --from-literal=token="$GIT_TOKEN"\n')))),Object(n.b)("h2",null,"ArgoCD Configuration"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Create a new Infra repository using the following git repo as template ",Object(n.b)("a",r({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy"}),"https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy")),Object(n.b)("li",{parentName:"ul"},"The new location of the Infra repository would look like ",Object(n.b)("inlineCode",{parentName:"li"},"https://github.com/${GIT_USER}/cloudnative_sample_app_deploy")),Object(n.b)("li",{parentName:"ul"},"Access the ArgoCD UI, to get the server url run the following command",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export ARGOCD_URL=$(oc get route argocd-server -n argocd -o jsonpath='{.spec.host}')\necho \"ARGOCD URL: https://$ARGOCD_URL\"\n"))),Object(n.b)("li",{parentName:"ul"},"Login into ArgoCD UI using ",Object(n.b)("inlineCode",{parentName:"li"},"admin")," as username and for the password get the name of the pod for the argocd server running the following command",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2\n"))),Object(n.b)("li",{parentName:"ul"},"Create a new ArgoCD application using the UI or CLI",Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"SYNC POLICY: ",Object(n.b)("inlineCode",{parentName:"li"},"Automatic")),Object(n.b)("li",{parentName:"ul"},"Application Name: ",Object(n.b)("inlineCode",{parentName:"li"},"${userid}-app")),Object(n.b)("li",{parentName:"ul"},"REPO URL: ",Object(n.b)("inlineCode",{parentName:"li"},"https://github.com/${GIT_USER}/cloudnative_sample_app_deploy")),Object(n.b)("li",{parentName:"ul"},"Revision: ",Object(n.b)("inlineCode",{parentName:"li"},"master")),Object(n.b)("li",{parentName:"ul"},"Path: ",Object(n.b)("inlineCode",{parentName:"li"},"yamls")),Object(n.b)("li",{parentName:"ul"},"Cluster: ",Object(n.b)("inlineCode",{parentName:"li"},"https://kubernetes.default.svc")," to deploy in-cluster"),Object(n.b)("li",{parentName:"ul"},"Namespace: ",Object(n.b)("inlineCode",{parentName:"li"},"bootcamp-cicd-${userid}")))),Object(n.b)("li",{parentName:"ul"},"Expose application by creating a ",Object(n.b)("inlineCode",{parentName:"li"},"route.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<'EOF' >route.yaml\napiVersion: route.openshift.io/v1\nkind: Route\nmetadata:\n  name: cloudnativesampleapp-route\nspec:\n  port:\n    targetPort: http\n  to:\n    kind: Service\n    name: cloudnativesampleapp-service\nEOF\n"))),Object(n.b)("li",{parentName:"ul"},"Apply the ",Object(n.b)("inlineCode",{parentName:"li"},"route.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f route.yaml -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Test the Application usin the new route",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export APP_URL=$(oc get route cloudnativesampleapp-route -o jsonpath='{.spec.host}' -n $NAMESPACE)\ncurl http://$APP_URL/greeting?name=Carlos\n")))),Object(n.b)("h2",null,"Tekton Pipeline Configuration"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Create a new Code repository using the following git repo as template ",Object(n.b)("a",r({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/cloudnative_sample_app"}),"https://github.com/ibm-cloud-architecture/cloudnative_sample_app")),Object(n.b)("li",{parentName:"ul"},"The new location of the Code repository would look like ",Object(n.b)("inlineCode",{parentName:"li"},"https://github.com/${GIT_USER}/cloudnative_sample_app")),Object(n.b)("li",{parentName:"ul"},"Create a git resource yaml ",Object(n.b)("strong",{parentName:"li"},"git.yaml"),", replace ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_USERNAME>")," with the git username or organization",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export GIT_USERNAME='<GIT_USERNAME>'\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<EOF >git.yaml\napiVersion: tekton.dev/v1alpha1\nkind: PipelineResource\nmetadata:\n  name: source\nspec:\n  type: git\n  params:\n    - name: revision\n      value: master\n    - name: url\n      value: https://github.com/$GIT_USERNAME/cloudnative_sample_app\nEOF\n")),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"Apply the ",Object(n.b)("inlineCode",{parentName:"li"},"git.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f git.yaml -n $NAMESPACE\n"))))),Object(n.b)("li",{parentName:"ul"},"Create an image resource yaml ",Object(n.b)("strong",{parentName:"li"},"image.yaml"),", the image url needs to specify the target namespace in ",Object(n.b)("inlineCode",{parentName:"li"},"$NAMESPACE")," for the ",Object(n.b)("inlineCode",{parentName:"li"},"default")," ServiceAccount in the namespace to be able to pull the image from the internal registry",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<EOF >image.yaml\napiVersion: tekton.dev/v1alpha1\nkind: PipelineResource\nmetadata:\n  name: image\nspec:\n  type: image\n  params:\n    - name: url\n      value: image-registry.openshift-image-registry.svc:5000/$NAMESPACE/cloudnative_sample_app\nEOF\n")),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"Apply the ",Object(n.b)("inlineCode",{parentName:"li"},"image.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f image.yaml -n $NAMESPACE\n"))))),Object(n.b)("li",{parentName:"ul"},"Verify the resources",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn resource ls  -n $NAMESPACE\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{}),"NAME     TYPE    DETAILS\nsource   git     url: https://github.com/csantanapr/cloudnative_sample_app\nimage    image   url: image-registry.openshift-image-registry.svc:5000/bootcamp-cicd-carlos/cloudnative_sample_app\n"))),Object(n.b)("li",{parentName:"ul"},"Download the task file ",Object(n.b)("a",r({parentName:"li"},{href:"/learning-cloudnative-101/yamls/project-cicd/solution/task-build-git.yaml"}),"task-build-git.yaml")," to build the image, push the image to the registy, and update the Infra git repository"),Object(n.b)("li",{parentName:"ul"},"Apply manifest",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f task-build-git.yaml -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Verify tasks",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn task ls -n $NAMESPACE\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{}),"NAME        AGE\nbuild-git   8 minutes ago\n"))),Object(n.b)("li",{parentName:"ul"},"Test the task using your own Infra git repository, replace the parameters values ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_EMAIL>"),", ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_NAME>"),", and ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_REPOSITORY>")," with your Infra git repository."),Object(n.b)("li",{parentName:"ul"},"Excluding the protocol scheme ",Object(n.b)("inlineCode",{parentName:"li"},"https://")," for example ",Object(n.b)("inlineCode",{parentName:"li"},"github.com/csantanapr/cloudnative_sample_app_deploy.git"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export GIT_EMAIL='<GIT_EMAIL>'\nexport GIT_NAME='<GIT_NAME>'\nexport GIT_REPOSITORY='<GIT_REPOSITORY>'\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn task start build-git \\\n        --showlog \\\n        -i source=source \\\n        -i image=image \\\n        -p GIT_EMAIL=$GIT_EMAIL \\\n        -p GIT_NAME=$GIT_NAME \\\n        -p GIT_REPOSITORY=$GIT_REPOSITORY \\\n        -s pipeline \\\n        -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Verify last task run ",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn taskrun ls --limit 1 -n $NAMESPACE\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{}),"NAME                  STARTED         DURATION    STATUS               \nbuild-git-run-d2j88   7 minutes ago   2 minutes   Succeeded\n"))),Object(n.b)("li",{parentName:"ul"},"Create a Pipeline ",Object(n.b)("strong",{parentName:"li"},"pipeline.yaml")," with the task, replace the parameters values ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_EMAIL>"),", ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_NAME>"),", and ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_REPOSITORY>"),"  with your Infra git repository."),Object(n.b)("li",{parentName:"ul"},"Excluding the protocol scheme ",Object(n.b)("inlineCode",{parentName:"li"},"https://")," for example ",Object(n.b)("inlineCode",{parentName:"li"},"github.com/csantanapr/cloudnative_sample_app_deploy.git"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export GIT_EMAIL='<GIT_EMAIL>'\nexport GIT_NAME='<GIT_NAME>'\nexport GIT_REPOSITORY='<GIT_REPOSITORY>'\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<EOF >pipeline.yaml\napiVersion: tekton.dev/v1alpha1\nkind: Pipeline\nmetadata:\n  name: project-cicd\nspec:\n  resources:\n    - name: source\n      type: git\n    - name: image\n      type: image\n  tasks:\n    - name: task\n      taskRef:\n        name: build-git\n      resources:\n        inputs:\n          - name: source\n            resource: source\n          - name: image\n            resource: image\n      params:\n        - name: GIT_REPOSITORY\n          value: $GIT_REPOSITORY\n        - name: GIT_EMAIL\n          value: $GIT_EMAIL\n        - name: GIT_NAME\n          value: $GIT_NAME\nEOF\n"))),Object(n.b)("li",{parentName:"ul"},"Apply manifest",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f pipeline.yaml -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Verify pipeline",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn pipeline ls -n $NAMESPACE\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{}),"NAME           AGE              LAST RUN   STARTED   DURATION   STATUS\nproject-cicd   22 seconds ago   ---        ---       ---        ---\n"))),Object(n.b)("li",{parentName:"ul"},"Run the Pipeline using the sevice account ",Object(n.b)("inlineCode",{parentName:"li"},"pipeline"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn pipeline start project-cicd \\\n        --showlog \\\n        -r source=source \\\n        -r image=image \\\n        -s pipeline \\\n        -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Verify las Pipeline Run",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn pipelinerun ls --limit 1 -n $NAMESPACE\n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{}),"NAME                     STARTED         DURATION    STATUS               \nproject-cicd-run-wvf82   4 minutes ago   2 minutes   Succeeded\n")))),Object(n.b)("h2",null,"Tekton Trigger Configuration"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Create the Trigger Template file ",Object(n.b)("strong",{parentName:"li"},"trigger-template.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<'EOF' >trigger-template.yaml\napiVersion: tekton.dev/v1alpha1\nkind: TriggerTemplate\nmetadata:\n  name: project-cicd\nspec:\n  params:\n    - name: gitrevision\n      description: The git revision\n      default: master\n    - name: gitrepositoryurl\n      description: The git repository url\n  resourcetemplates:\n    - apiVersion: tekton.dev/v1alpha1\n      kind: PipelineRun\n      metadata:\n        generateName: project-cicd-run-\n      spec:\n        pipelineRef:\n          name: project-cicd\n        resources:\n          - name: image\n            resourceRef:\n              name: image\n          - name: source\n            resourceSpec:\n              type: git\n              params:\n                - name: revision\n                  value: $(params.gitrevision)\n                - name: url\n                  value: $(params.gitrepositoryurl)\nEOF\n"))),Object(n.b)("li",{parentName:"ul"},"Apply manifest",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f trigger-template.yaml -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Create the Trigger Template file ",Object(n.b)("strong",{parentName:"li"},"trigger-binding.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<'EOF' >trigger-binding.yaml\napiVersion: tekton.dev/v1alpha1\nkind: TriggerBinding\nmetadata:\n  name: project-cicd\nspec:\n  params:\n    - name: gitrevision\n      value: $(body.head_commit.id)\n    - name: gitrepositoryurl\n      value: $(body.repository.url)\n    - name: contenttype\n      value: $(header.Content-Type)\nEOF\n"))),Object(n.b)("li",{parentName:"ul"},"Apply manifest",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f trigger-binding.yaml -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Create the Trigger Template file ",Object(n.b)("strong",{parentName:"li"},"trigger-listerner.yaml"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"cat <<'EOF' >trigger-listerner.yaml\napiVersion: tekton.dev/v1alpha1\nkind: EventListener\nmetadata:\n  name: project-cicd\nspec:\n  serviceAccountName: pipeline\n  triggers:\n    - name: project-cicd-trig\n      binding:\n        name: project-cicd\n      template:\n        name: project-cicd\nEOF\n"))),Object(n.b)("li",{parentName:"ul"},"Apply manifest",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc apply -f trigger-listerner.yaml -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"To test in a new terminal start a port forward session",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"kubectl port-forward $(oc get pod -o=name -l eventlistener=project-cicd) 8080 -n $NAMESPACE\n"))),Object(n.b)("li",{parentName:"ul"},"Now send a HTTP Request simulating a Github webhook event, replace the ",Object(n.b)("inlineCode",{parentName:"li"},"url")," value below.",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'curl -X POST \\\n  https://el-project-cicd-bootcamp-cicd-carlos.cpat-dev-bootcamp-ocp43-afb9c6047b062b44e3f1b3ecfeba4309-0000.us-south.containers.appdomain.cloud \\\n  -H \'Content-Type: application/json\' \\\n  -H \'X-Hub-Signature: sha1=2da37dcb9404ff17b714ee7a505c384758ddeb7b\' \\\n  -d \'{\n        "head_commit":\n        {\n                "id": "master"\n        },\n        "repository":\n        {\n                "url": "https://github.com/csantanapr/cloudnative_sample_app.git"\n        }\n}\'\n'))),Object(n.b)("li",{parentName:"ul"},"Verify Pipeline run is running",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn pipelinerun ls --limit 1 -n $NAMESPACE  \n")),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{}),"NAME                     STARTED         DURATION   STATUS             \nproject-cicd-run-xcjt8   5 seconds ago   ---        Running\n")),"  Get the logs",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"tkn pipelinerun logs -f -a -n $NAMESPACE project-cicd-run-xcjt8\n"))),Object(n.b)("li",{parentName:"ul"},"Expose Event Listener service via secure route",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"oc create route edge --service=el-project-cicd\n"))),Object(n.b)("li",{parentName:"ul"},"Get the URL to configure in Git repository Web Hook ",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export GIT_WEBHOOL_URL=$(oc get route el-project-cicd -o jsonpath='{.spec.host}' -n $NAMESPACE)\necho \"https://$GIT_WEBHOOL_URL\"\n"))),Object(n.b)("li",{parentName:"ul"},"Create the Git Web Hook Manually to send ",Object(n.b)("inlineCode",{parentName:"li"},"push")," events or create programatically below, replace ",Object(n.b)("inlineCode",{parentName:"li"},"<GIT_REPO_NAME>")," for Code repo name",Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"export GIT_USERNAME='<GIT_USERNAME>'\nexport GIT_TOKEN='<GIT_TOKEN>'\nexport GIT_REPO_NAME='<GIT_REPO_NAME>'\n"))),Object(n.b)("li",{parentName:"ul"},"Run ",Object(n.b)("inlineCode",{parentName:"li"},"curl")," to create the web hook")),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'curl -v -X POST -u $GIT_USERNAME:$GIT_TOKEN \\\n-d "{\\"name\\": \\"web\\",\\"active\\": true,\\"events\\": [\\"push\\"],\\"config\\": {\\"url\\": \\"https://$GIT_WEBHOOL_URL\\",\\"content_type\\": \\"json\\",\\"insecure_ssl\\": \\"0\\"}}"  -L https://api.github.com/repos/$GIT_USERNAME/$GIT_REPO_NAME/hooks\n')),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"NOTE")," Do not share the url, as it’s not configure with secret, for production configure the listener and the git web hook with a secret"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Make a change on the Code repository, and verify that Github sent the WebHook to the event listener, and that the Pipeline runs in OpenShift Console\n",Object(n.b)("span",r({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(n.b)("span",r({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"58.18686401480111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB80lEQVQoz4WR30/TUBTH+x8YWSrDHw88uFFAE+KI72p4MVFeNGLUGeKbQNZtODaVZEkXeeBfEsggRvuwPfCiD0YeJCFr1rW97e3t/VVP1xkwQT1pbtN7zuf7PedUqb4z9IaxsWk0jQ9NY6ux2dTX65Va432zdffOvdzk5PVc7v7CwuPFxUcPHxSXnrx4ulQsFl8+f/ZqeVnhcUxEzER8NjhncNbqb9WJq1p+er+9SxlDrsuiKKYEUuzkiDuWggkTnPWsvmX1PeS7HtR4fdsB0Y16Y/zytXxOO9g/APEwxEwISbAUo1BQSOHGsl0fh0GAfR8zxsAH5KvrNTV7RZuaaX/cGbgoxDjpioSxlGmDik8E58LzEIcY6kmZSEOupFcujKnzhdullde35gumaSYT4eAUDgnYcN8PKKOcMlCA1AguVy5mxufmCtut1pty+evhIVwKgH+HQnniY9sOjIoGDoWVwD4YT+GMmp2anv30uQPfXhDFEt7yFE4OKWkQRRE9s+2R85ia1WZu7u61ZVIl4z8jgcH52+BHz+uzKPllMoFT5+rQ+Yb5xUzLzoFZRLpHnZ/H34WHJCExIXw4mL5WylyayGuznW73LzBj8uQYe6HtYgcFEpYtZDqCvrL6Pxj6xMEA+T3HtxGGueCJ6BBeXfs3/AvDHkZZp1xtHwAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",r({parentName:"span"},{className:"gatsby-resp-image-image",alt:"WebHook to Pipeline",title:"WebHook to Pipeline",src:"/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/3cbba/webhook-pipeline.png",srcSet:["/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/7fc1e/webhook-pipeline.png 288w","/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/a5df1/webhook-pipeline.png 576w","/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/3cbba/webhook-pipeline.png 1152w","/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/0b124/webhook-pipeline.png 1728w","/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/4ea69/webhook-pipeline.png 2304w","/learning-cloudnative-101/static/210269ba7247faa40527e1ac344e276e/d7ddf/webhook-pipeline.png 4324w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(n.b)("li",{parentName:"ul"},"After the Pipeline run is done, wait a few minutes the application should be updated by ArgoCD\n",Object(n.b)("span",r({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(n.b)("span",r({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"27.922511690046758%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAABYlAAAWJQFJUiTwAAABGklEQVQY0yWP6W6DMBCEef9n6s9WaqUqopA0CYe5bOOL00DBHO7SrlajGcujz3auUfqIUI4pJizJihBlKC1ilIGJ0xxlxTNKmJDjMPT6nEHrpu1yLnKunDfPd29B049unLxe/Mv16d7DF/fr3fv2H/EtiD+9u1C1tfY4Dvs367rt275b6/wYsx8WvF6WapjW/Vj3nQNgnmezwsKJ2bZpXubFLGaFNev2b5ygKBEVMRWnEp4yCe8pmMK8SplKSklkXXBFqxZiREREeEg4KFScj2vgJ3ml9TjNotNYVLRtml4P48TbHou6H6cO/jpNBPqloKomsgJFpTzJEWBLARDIoIk4OVS1EEPMsKpZ1RLVoPOaLJtW1F3GJLR+AaN0SS4kOPI0AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",r({parentName:"span"},{className:"gatsby-resp-image-image",alt:"ArgoCD App Updated",title:"ArgoCD App Updated",src:"/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/3cbba/argocd.png",srcSet:["/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/7fc1e/argocd.png 288w","/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/a5df1/argocd.png 576w","/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/3cbba/argocd.png 1152w","/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/0b124/argocd.png 1728w","/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/4ea69/argocd.png 2304w","/learning-cloudnative-101/static/e59b292aa05fcae454ebd0947278736f/8849b/argocd.png 2994w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "))))}m.isMDXComponent=!0},pEPl:function(e){e.exports=JSON.parse('{"data":{"site":{"id":"Site","siteMetadata":{"repository":{"baseUrl":"https://github.com/ibm-cloud-architecture/learning-cloudnative-101","subDirectory":"/","branch":"master"}}}}}')},pOBw:function(e){e.exports=JSON.parse('{"data":{"site":{"id":"Site","pathPrefix":"/learning-cloudnative-101"}}}')}}]);
//# sourceMappingURL=component---src-pages-project-cicd-solution-mdx-4e1bda28aa6ac086ddfb.js.map